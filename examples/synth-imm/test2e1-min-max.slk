data node{
     int key;
     node down;
     node fwd;
}.


pred skl0<p> ==
    self = p    or
    self::node<_,p,p> & self!=p or //can comment out
    self::node<val,down,fwd> * down::skl0<fwd> * fwd::skl0<p>
    & self!=p & self!=fwd
    inv true.

pred skl1<p,n> ==
    self=p & n=0 or
    self::node<_,p,p> & self!=p & n = 1 or //can comment out
    self::node<val,down,fwd> * down::skl1<fwd,m1> * fwd::skl1<p,m2>
    & self!=p & self!=fwd  & self!=down
    & n = m1 + m2 + 1 & n > 1
    inv n>=0.

/*
pred skl2<p,n,mn,mx> ==
    self = p    & n=0
    or
    self::node<mn,p,p> & self!=p & n = 1 & mn=mx
    or
    self::node<mn,down,fwd> *
    down::skl2<fwd,m1,mn1,mx1> *
    fwd::skl2<p,m2,mn2,mx>
    & self!=p
    & n = m1 + m2 + 1
    & mx1<=mn2 & mn<=mn1 & mn1<=mx1 & mn2<=mx
    inv n>=0.

pred lsort2<p,n,mn,mx> ==
                  self=p & n=0 or
                  self::node<mn,null,p>  & mn=mx & n=1 & self!=p or
                  self::node<mn,null,q> * q::lsort2<p,n-1,mn1,mx> & n>1 & mn<=mn1 & self!=p & self!=q & mn1<=mx
                  inv n>=0.

checkentail x::lsort2<p,n,mn,mx> & x!=p |- mn<=mx.
checkentail x::skl2<p,n,mn,mx> & x!=p   |- mn<=mx.
*/

pred skl2<p,n,mn,mx> ==
    self = p    & n=0
    or
    /* empty down & fwd */
    self::node<mn,p,p> & self!=p & n = 1 & mn=mx
    or
    /* empty down */
    self::node<mn,fwd,fwd> *
    fwd::skl2<p,m2,mn2,mx>
    & self!=p & fwd!=p
    & n = m2 + 1
    & mn<=mn2 & mn2<=mx
    /* empty fwd */
    or
    self::node<mn,down,p> *
    down::skl2<p,m1,mn1,mx>
    & self!=p & down!=p
    & n = m1 + 1
    & mn<=mn1 & mn1<=mx
    /* non-empty down & non-empty fwd*/
    or
    self::node<mn,down,fwd> *
    down::skl2<fwd,m1,mn1,mx1> *
    fwd::skl2<p,m2,mn2,mx>
    & self!=p & fwd!=p & down!=fwd
    & n = m1 + m2 + 1
    & mx1<=mn2 & mn<=mn1 & mn1<=mx1 & mn2<=mx
    inv n>=0.


//1.  Valid - 8.982729 second(s) (default: 4.81947 second(s))
//SAT Count   : 3497             (default: SAT Count   : 1689)
checkentail x::node<1,f1,f1> *
            f1::node<5,f3,f3> *
            f3::node<6,_,_>
            |- x::skl2<f3,2,1,5>.
print residue.


/*
//2. Valid - 205.446782 second(s) (default: 34.491255 second(s))
//SAT Count   : 74896             (default: SAT Count   : 11576)
checkentail x::node<1,d1,f1> *
            d1::node<2,f1,f1> *
            f1::node<5,f3,f3> *
            f3::node<6,_,_>
            |- x::skl2<f3,3,1,5>.
print residue.
*/

/*
//3. Valid - 5411.189568 second(s) (default: 222.907118 second(s))
// SAT Count   : 1605273           (default: SAT Count   : 70981)
checkentail x::node<1,d1,f1> *
            d1::node<2,f2,f2> *
            f2::node<4,f1,f1> *
            f1::node<5,f3,f3> *
            f3::node<6,_,_>
            |- x::skl2<f3,4,1,5>.
print residue.
*/
