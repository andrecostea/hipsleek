# ex1e.ss

pred arr_int<i:int,v:int> ==
    p::arr<v> & p=self+i & i>=0
inv i>=0;

arr_seg<i:int,n:int> == emp & i>=n & n>=0
  or p::arr<_> * self::arr_seg<i+1,n> & p=self+i & i>=0
  inv n>=0 & i>=0;

# failure of folding without virtual links..

# need to build some sleek test for this approach..

!!!dumping for foo2$arr~int FAIL2
!!!  
id: 8; caller: []; line: 34; classic: false; kind: PRE; hec_num: 1; evars: []; impl_vars: [Anon_11]; infer_vars: [ ]; c_heap: emp; others:  es_infer_obj: [] globals: [@dis_err]
 checkentail a::arr_seg<i_1774,flted_30_1775>@M&
v_bool_33_1739' & i'<10 & i_1774=i & i<=10 & flted_30_1775=10 & i'=i & 
a'=a & v_int_34_1732'=5 & MayLoop[]&{FLOW,(4,5)=__norm#E}[]
 |-  (exists i_82: a'::arr_int<i_82,Anon_11>@M&i_82=i'&{FLOW,(4,5)=__norm#E}[]). 
ho_vars: nothing?
res:  failctxfe_kind: MAY
        fe_name: separation entailment
        fe_locs: {
    fc_message: do_unmatched_rhs : p_1788::arr<v_1793>@M(may)
    fc_current_lhs_flow: {FLOW,(4,11)=__MayError#E}
  }
[[ Fold ==>  UnmatchedRHSData]]falseStop z3... 100 invocations 

=================================================================
# ex1c2.ss

# current ptr failures..

checkentail x::arr<5> * y::arr<4> & x=(y:arr)+2 & z=y+2 |- z::arr<v>.
print residue.
expect Valid.
//Entail 3: Fail.(may) cause:do_unmatched_rhs : z::arr<v>@M(may)

(==context.ml#3147==)
choose_context@1
choose_context inp1 :LHS node: x::arr<flted_19_63>@M * y::arr<flted_19_62>@M
choose_context inp2 :RHS node: z::arr<v>@M
choose_context inp3 :LHS pure: z=2+y & x=2+y & flted_19_62=4 & flted_19_63=5
choose_context inp4 :RHS pure: true
choose_context inp5 :right aliase:[]
choose_context@1 EXIT:[]

checkentail x::arr<5> & x=(y:arr)+2 |- y::arr_int<2,v>.
print residue.
//Entail 1: Fail.(may) cause:do_unmatched_rhs : y::arr_int<flted_14_76,v>@M(may)
expect Valid.


(==context.ml#3147==)
choose_context@3
choose_context inp1 :LHS node: x::arr<flted_24_79>@M
choose_context inp2 :RHS node: y::arr_int<flted_24_94,v>@M
choose_context inp3 :LHS pure: x=2+y & flted_24_79=5
choose_context inp4 :RHS pure: flted_24_94=2
choose_context inp5 :right aliase:[]
choose_context@3 EXIT:[]

=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
=================================================================
